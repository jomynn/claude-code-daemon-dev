<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Usage Analytics</h1>
            <nav>
                <a href="/">Dashboard</a>
                <a href="/usage" class="active">Usage Analytics</a>
                <a href="/alerts">Alerts</a>
                <a href="/projects">Projects</a>
                <a href="/workspace">Workspace</a>
                <a href="/logs">Logs</a>
            </nav>
            <div class="status-indicator">
                <span id="connection-status" class="status-dot"></span>
                <span>Live</span>
            </div>
        </header>

        <main>
            <div class="usage-controls">
                <div class="control-group">
                    <label for="time-range">Time Range:</label>
                    <select id="time-range">
                        <option value="hour">Last Hour</option>
                        <option value="day" selected>Last 24 Hours</option>
                        <option value="week">Last Week</option>
                        <option value="month">Last Month</option>
                    </select>
                </div>

                <div class="control-group">
                    <button id="export-btn" class="btn">Export Data</button>
                    <button id="refresh-btn" class="btn">Refresh</button>
                </div>
            </div>

            <div class="usage-stats">
                <div class="stat-card">
                    <h3>Total Tokens</h3>
                    <div class="stat-value" id="total-tokens">0</div>
                    <div class="stat-label">Current Period</div>
                </div>

                <div class="stat-card">
                    <h3>Average Rate</h3>
                    <div class="stat-value" id="avg-rate">0</div>
                    <div class="stat-label">Tokens/Hour</div>
                </div>

                <div class="stat-card">
                    <h3>Peak Usage</h3>
                    <div class="stat-value" id="peak-usage">0</div>
                    <div class="stat-label">Highest Hour</div>
                </div>

                <div class="stat-card">
                    <h3>Predictions</h3>
                    <div class="stat-value" id="prediction-accuracy">0%</div>
                    <div class="stat-label">Model Accuracy</div>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container large">
                    <h3>Token Usage Over Time</h3>
                    <canvas id="tokens-chart"></canvas>
                </div>

                <div class="chart-container">
                    <h3>Usage Distribution</h3>
                    <canvas id="distribution-chart"></canvas>
                </div>

                <div class="chart-container">
                    <h3>Request Pattern</h3>
                    <canvas id="pattern-chart"></canvas>
                </div>
            </div>

            <div class="predictions-section">
                <h3>Usage Predictions</h3>
                <div class="prediction-container">
                    <div class="prediction-chart">
                        <canvas id="prediction-chart"></canvas>
                    </div>
                    <div class="prediction-details">
                        <div class="prediction-item">
                            <span class="label">Predicted Limit Hit:</span>
                            <span class="value" id="predicted-time">--</span>
                        </div>
                        <div class="prediction-item">
                            <span class="label">Confidence Level:</span>
                            <span class="value" id="confidence-level">--</span>
                        </div>
                        <div class="prediction-item">
                            <span class="label">Trend:</span>
                            <span class="value" id="usage-trend">--</span>
                        </div>
                        <div class="prediction-item">
                            <span class="label">Recommendation:</span>
                            <span class="value" id="recommendation">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="usage-table">
                <h3>Recent Usage Data</h3>
                <div class="table-controls">
                    <input type="text" id="search-input" placeholder="Search...">
                </div>
                <table id="usage-data-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Tokens</th>
                            <th>Requests</th>
                            <th>Rate (Tokens/Hour)</th>
                            <th>Request Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </main>

        <footer>
            <p>Claude Code Daemon &copy; 2024 | Environment: <%= env %></p>
        </footer>
    </div>

    <script src="/static/js/usage.js"></script>
</body>
</html>

<style>
.usage-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding: 20px;
    background: var(--card-bg);
    border-radius: 8px;
    border: 1px solid var(--border-color);
}

.control-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.control-group label {
    color: var(--text-secondary);
    font-size: 14px;
}

.control-group select {
    background: var(--dark-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    padding: 8px 12px;
    border-radius: 4px;
}

.btn {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
}

.btn:hover {
    background: #1976D2;
}

.usage-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.charts-section {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

.chart-container.large {
    grid-column: span 3;
}

.predictions-section {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    margin-bottom: 30px;
}

.prediction-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    margin-top: 20px;
}

.prediction-details {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.prediction-item {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
}

.prediction-item .label {
    color: var(--text-secondary);
    font-size: 14px;
}

.prediction-item .value {
    color: var(--text-primary);
    font-weight: 500;
}

.usage-table {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
}

.table-controls {
    margin-bottom: 15px;
}

.table-controls input {
    background: var(--dark-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    padding: 8px 12px;
    border-radius: 4px;
    width: 200px;
}

table {
    width: 100%;
    border-collapse: collapse;
}

table th,
table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}

table th {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-secondary);
    font-weight: 500;
}

table td {
    color: var(--text-primary);
}

@media (max-width: 768px) {
    .charts-section {
        grid-template-columns: 1fr;
    }

    .chart-container.large {
        grid-column: span 1;
    }

    .prediction-container {
        grid-template-columns: 1fr;
    }

    .usage-controls {
        flex-direction: column;
        gap: 15px;
    }
}
</style>