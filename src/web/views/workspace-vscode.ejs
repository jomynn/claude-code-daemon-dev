<!DOCTYPE html>
<html lang="en" class="vscode-dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Daemon - VS Code Edition</title>

    <!-- VS Code Theme CSS -->
    <link rel="stylesheet" href="/static/css/vscode-theme.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@vscode/codicons@0.0.35/dist/codicon.css">

    <!-- Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- Terminal -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.js"></script>

    <!-- Monaco Editor -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
</head>
<body>
    <div class="vscode-container">
        <!-- Title Bar -->
        <div class="vscode-titlebar">
            <div class="title">Claude Code Daemon - <%= project ? project.name : 'No Project' %></div>
            <div class="window-controls">
                <button class="window-control" id="minimize-btn">
                    <i class="codicon codicon-chrome-minimize"></i>
                </button>
                <button class="window-control" id="maximize-btn">
                    <i class="codicon codicon-chrome-maximize"></i>
                </button>
                <button class="window-control" id="close-btn">
                    <i class="codicon codicon-close"></i>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="vscode-main">
            <!-- Activity Bar -->
            <div class="vscode-activity-bar">
                <div class="activity-icon active" data-view="explorer" title="Explorer">
                    <i class="codicon codicon-files"></i>
                </div>
                <div class="activity-icon" data-view="search" title="Search">
                    <i class="codicon codicon-search"></i>
                </div>
                <div class="activity-icon" data-view="source-control" title="Source Control">
                    <i class="codicon codicon-source-control"></i>
                </div>
                <div class="activity-icon" data-view="debug" title="Run and Debug">
                    <i class="codicon codicon-debug-alt"></i>
                </div>
                <div class="activity-icon" data-view="extensions" title="Extensions">
                    <i class="codicon codicon-extensions"></i>
                </div>
                <div class="activity-icon" data-view="claude" title="Claude AI">
                    <i class="codicon codicon-hubot"></i>
                </div>
                <div style="flex: 1;"></div>
                <div class="activity-icon" data-view="settings" title="Settings">
                    <i class="codicon codicon-settings-gear"></i>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="vscode-sidebar" id="sidebar">
                <!-- Explorer View -->
                <div class="sidebar-view" id="explorer-view">
                    <div class="sidebar-header">
                        <span class="sidebar-title">EXPLORER</span>
                        <div class="sidebar-actions">
                            <button class="icon-button" title="New File">
                                <i class="codicon codicon-new-file"></i>
                            </button>
                            <button class="icon-button" title="New Folder">
                                <i class="codicon codicon-new-folder"></i>
                            </button>
                            <button class="icon-button" title="Refresh">
                                <i class="codicon codicon-refresh"></i>
                            </button>
                        </div>
                    </div>
                    <div class="sidebar-content">
                        <div class="file-tree" id="file-tree">
                            <!-- File tree will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Claude AI View -->
                <div class="sidebar-view" id="claude-view" style="display: none;">
                    <div class="sidebar-header">
                        <span class="sidebar-title">CLAUDE AI ASSISTANT</span>
                    </div>
                    <div class="sidebar-content" style="padding: 10px;">
                        <div class="claude-chat-container">
                            <div class="chat-messages" id="claude-messages">
                                <!-- Claude chat messages -->
                            </div>
                            <div class="chat-input-container">
                                <textarea class="vscode-input" id="claude-input"
                                    placeholder="Ask Claude for help..."
                                    style="width: 100%; min-height: 60px; resize: vertical;"></textarea>
                                <div style="margin-top: 5px;">
                                    <button class="vscode-button" id="send-to-claude">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other sidebar views would go here -->
            </div>

            <!-- Editor Area -->
            <div class="vscode-editor-area">
                <!-- Tabs -->
                <div class="vscode-tabs" id="editor-tabs">
                    <div class="tab active">
                        <i class="codicon codicon-file-code"></i>
                        <span class="tab-label">Welcome</span>
                        <span class="tab-close">
                            <i class="codicon codicon-close"></i>
                        </span>
                    </div>
                </div>

                <!-- Editor Content -->
                <div class="vscode-editor-content">
                    <div class="editor-container" id="editor-container">
                        <!-- Monaco editor will be inserted here -->
                        <div id="monaco-editor" style="width: 100%; height: 100%;"></div>
                    </div>
                </div>

                <!-- Terminal Panel -->
                <div class="vscode-panel" id="panel">
                    <div class="panel-header">
                        <div class="panel-tabs">
                            <button class="panel-tab active" data-panel="terminal">Terminal</button>
                            <button class="panel-tab" data-panel="problems">Problems</button>
                            <button class="panel-tab" data-panel="output">Output</button>
                            <button class="panel-tab" data-panel="debug-console">Debug Console</button>
                        </div>
                        <div style="flex: 1;"></div>
                        <div class="panel-actions">
                            <button class="icon-button" title="New Terminal">
                                <i class="codicon codicon-add"></i>
                            </button>
                            <button class="icon-button" title="Split Terminal">
                                <i class="codicon codicon-split-horizontal"></i>
                            </button>
                            <button class="icon-button" title="Kill Terminal">
                                <i class="codicon codicon-trash"></i>
                            </button>
                            <button class="icon-button" id="toggle-panel" title="Toggle Panel">
                                <i class="codicon codicon-chevron-down"></i>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div id="terminal-container" style="width: 100%; height: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="vscode-statusbar">
            <div class="statusbar-item">
                <i class="codicon codicon-remote"></i>
                <span>Claude Code Daemon</span>
            </div>
            <div class="statusbar-item">
                <i class="codicon codicon-git-branch"></i>
                <span id="git-branch">main</span>
            </div>
            <div style="flex: 1;"></div>
            <div class="statusbar-item" id="project-status">
                <i class="codicon codicon-folder"></i>
                <span><%= project ? project.name : 'No Project' %></span>
            </div>
            <div class="statusbar-item">
                <i class="codicon codicon-bell"></i>
            </div>
            <div class="statusbar-item">
                <span>UTF-8</span>
            </div>
            <div class="statusbar-item">
                <span>LF</span>
            </div>
            <div class="statusbar-item">
                <span>JavaScript</span>
            </div>
        </div>
    </div>

    <!-- VS Code Workspace JavaScript -->
    <script>
        // Initialize Monaco Editor
        require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' }});

        require(['vs/editor/editor.main'], function() {
            // VS Code Dark Theme
            monaco.editor.defineTheme('vscode-dark', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '6A9955' },
                    { token: 'keyword', foreground: '569CD6' },
                    { token: 'string', foreground: 'CE9178' },
                    { token: 'number', foreground: 'B5CEA8' },
                    { token: 'function', foreground: 'DCDCAA' },
                    { token: 'variable', foreground: '9CDCFE' },
                    { token: 'type', foreground: '4EC9B0' }
                ],
                colors: {
                    'editor.background': '#1E1E1E',
                    'editor.foreground': '#D4D4D4',
                    'editor.selectionBackground': '#264F78',
                    'editor.lineHighlightBackground': '#2A2A2A',
                    'editorCursor.foreground': '#FFFFFF',
                    'editorWhitespace.foreground': '#404040'
                }
            });

            // Create editor instance
            window.monacoEditor = monaco.editor.create(document.getElementById('monaco-editor'), {
                value: `// Welcome to Claude Code Daemon - VS Code Edition
// Start coding with AI assistance!

function hello() {
    console.log('Hello from Claude Code Daemon!');
}

hello();
`,
                language: 'javascript',
                theme: 'vscode-dark',
                fontSize: 14,
                fontFamily: "'Cascadia Code', 'Fira Code', Consolas, 'Courier New', monospace",
                fontLigatures: true,
                minimap: {
                    enabled: true
                },
                scrollBeyondLastLine: false,
                automaticLayout: true,
                wordWrap: 'on'
            });
        });

        // Initialize Terminal
        document.addEventListener('DOMContentLoaded', function() {
            const term = new Terminal({
                theme: {
                    background: '#1E1E1E',
                    foreground: '#D4D4D4',
                    cursor: '#FFFFFF',
                    selection: '#264F78',
                    black: '#000000',
                    red: '#CD3131',
                    green: '#0DBC79',
                    yellow: '#E5E510',
                    blue: '#2472C8',
                    magenta: '#BC3FBC',
                    cyan: '#11A8CD',
                    white: '#E5E5E5',
                    brightBlack: '#666666',
                    brightRed: '#F14C4C',
                    brightGreen: '#23D18B',
                    brightYellow: '#F5F543',
                    brightBlue: '#3B8EEA',
                    brightMagenta: '#D670D6',
                    brightCyan: '#29B8DB',
                    brightWhite: '#E5E5E5'
                },
                fontFamily: "'Cascadia Code', 'Fira Code', Consolas, monospace",
                fontSize: 13,
                lineHeight: 1.2
            });

            const fitAddon = new FitAddon.FitAddon();
            term.loadAddon(fitAddon);

            term.open(document.getElementById('terminal-container'));
            fitAddon.fit();

            term.writeln('Welcome to Claude Code Daemon Terminal');
            term.writeln('Type "help" for available commands');
            term.write('$ ');

            // Handle terminal input
            term.onData(data => {
                // Send data to backend via socket
                if (window.socket) {
                    window.socket.emit('terminal-input', { data });
                }
                term.write(data);
            });

            window.addEventListener('resize', () => {
                fitAddon.fit();
            });
        });

        // Activity Bar Navigation
        document.querySelectorAll('.activity-icon').forEach(icon => {
            icon.addEventListener('click', function() {
                document.querySelectorAll('.activity-icon').forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                const view = this.getAttribute('data-view');
                // Show corresponding sidebar view
                document.querySelectorAll('.sidebar-view').forEach(v => v.style.display = 'none');
                const targetView = document.getElementById(`${view}-view`);
                if (targetView) {
                    targetView.style.display = 'block';
                }
            });
        });

        // Panel Tab Switching
        document.querySelectorAll('.panel-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                // Handle panel content switching
            });
        });

        // Toggle Panel
        document.getElementById('toggle-panel').addEventListener('click', function() {
            const panel = document.getElementById('panel');
            panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
            const icon = this.querySelector('i');
            icon.className = panel.style.display === 'none' ? 'codicon codicon-chevron-up' : 'codicon codicon-chevron-down';
        });

        // Initialize Socket Connection
        const socket = io();
        window.socket = socket;

        socket.on('connect', () => {
            console.log('Connected to Claude Code Daemon');
        });

        socket.on('file-tree-update', (data) => {
            // Update file tree
            updateFileTree(data);
        });

        socket.on('terminal-output', (data) => {
            if (window.term) {
                window.term.write(data);
            }
        });

        // File Tree Functions
        function updateFileTree(files) {
            const treeContainer = document.getElementById('file-tree');
            // Implement file tree rendering
        }

        // Claude AI Integration
        document.getElementById('send-to-claude').addEventListener('click', function() {
            const input = document.getElementById('claude-input');
            const message = input.value.trim();

            if (message) {
                socket.emit('claude-message', { message });

                // Add message to chat
                const messagesContainer = document.getElementById('claude-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message user';
                messageDiv.textContent = message;
                messagesContainer.appendChild(messageDiv);

                input.value = '';
            }
        });

        socket.on('claude-response', (data) => {
            const messagesContainer = document.getElementById('claude-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message assistant';
            messageDiv.textContent = data.response;
            messagesContainer.appendChild(messageDiv);
        });
    </script>

    <style>
        /* Additional styles for components */
        .icon-button {
            background: transparent;
            border: none;
            color: var(--vscode-icon-foreground);
            padding: 2px 5px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .icon-button:hover {
            background-color: var(--vscode-hover);
        }

        .sidebar-actions {
            display: flex;
            gap: 2px;
        }

        .panel-actions {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--vscode-border);
            background-color: var(--vscode-editor-bg);
            min-height: 300px;
        }

        .chat-message {
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 4px;
        }

        .chat-message.user {
            background-color: var(--vscode-button-bg);
            color: white;
            margin-left: 20%;
        }

        .chat-message.assistant {
            background-color: var(--vscode-input-bg);
            margin-right: 20%;
        }

        .claude-chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-input-container {
            padding-top: 10px;
            border-top: 1px solid var(--vscode-border);
        }
    </style>
</body>
</html>